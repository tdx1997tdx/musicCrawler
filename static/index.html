<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>音乐下载工具</title>
    <link rel="stylesheet" href="./lib/bootstrap.css">
    <script src="./lib/vue.js"></script>
    <script src="./lib/axios.js"></script>
    <style>
        * {
            margin: 0px;
            border: 0px;
        }
    </style>
</head>

<body>
    <div id="app">
        <div class="bg-primary text-center">
            <h2>音乐下载工具</h2>
        </div>
        <form class="form-inline text-center">
            <div class="form-group">
                <label for="nameInput">歌曲名</label>
                <input type="text" class="form-control" id="nameInput" v-model="name">
            </div>
            <div class="form-group">
                <label for="authorInput">作者名</label>
                <input type="text" class="form-control" id="authorInput" v-model="author">
            </div>
            <button type="button" class="btn btn-primary" v-on:click="search">搜索</button>
        </form>
        <hr />
        <table class="table table-hover .table-bordered">
            <thead>
                <tr>
                    <th>id</th>
                    <th>歌曲名</th>
                    <th>作者</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
                <tr v-for="(item,i) in music_list">
                    <td>{{i+1}}</td>
                    <td>{{item.name}}</td>
                    <td>{{item.author}}</td>
                    <td>
                        <a :href="item.url" target="_blank">试听</a>
                        <a href="#" v-on:click="download(i)">下载</a>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <script type="text/javascript">
        var vm = new Vue({
            el: '#app',
            data: {
                name: '',
                author: '',
                music_list: [{
                    name: 'tdx',
                    author: 'tdx',
                    url: 'http://www.baidu.com'
                }]
            },
            methods: {
                async search() {
                    var list = []
                    await axios({
                            url: '/search',
                            method: 'post',
                            data: {
                                'name': this.name,
                                "author": this.author
                            },
                            headers: {
                                "Content-Type": "application/json;"
                            }
                        }).then(function(response) {
                            list = response.data['music_list']
                        })
                        .catch(function(error) {
                            console.log(error);
                        })
                    console.log(list)
                    this.music_list = list
                },
                async download(i) {
                    console.log(i, this.music_list[i])
                    var msg = ''
                    await axios({
                            url: '/download',
                            method: 'post',
                            data: this.music_list[i],
                            headers: {
                                "Content-Type": "application/json;"
                            }
                        }).then(function(response) {
                            msg = response.data
                        })
                        .catch(function(error) {
                            console.log(error);
                        })
                    if (msg.state == '1') {
                        alert("下载完成")
                    } else {
                        alert("下载失败")
                    }

                }
            }
        })
    </script>


</body>

</html>